# https://wintercms.com/docs/backend/lists#list-filters
scopes:
    calendar:
        label: acornassociated.calendar::lang.models.calendar.label
        modelClass: AcornAssociated\Calendar\Models\Calendar
        conditions: (select ce.calendar_id from acornassociated_calendar_event_parts cep inner join acornassociated_calendar_events ce on cep.event_id = ce.id where event_part_id = cep.id) in (:filtered)
        nameFrom: name
    date:
        label: acornassociated.calendar::lang.models.calendar.date_range
        type: daterange
        yearRange: 10
        conditions: (date >= fn_acornassociated_calendar_is_date(':after'::varchar, now()::timestamp) - '7 days'::interval AND date <= fn_acornassociated_calendar_is_date(':before'::varchar, now()::timestamp + interval '1 month'))

    status:
        label: acornassociated.calendar::lang.models.calendar.status
        modelClass: AcornAssociated\Calendar\Models\EventStatus
        conditions: (select ce.status_id from acornassociated_calendar_event_parts ce where event_part_id = ce.id) in (:filtered)
        nameFrom: name

    type:
        label: acornassociated.calendar::lang.models.calendar.type
        modelClass: AcornAssociated\Calendar\Models\EventType
        conditions: (select ce.type_id from acornassociated_calendar_event_parts ce where event_part_id = ce.id) in (:filtered)
        nameFrom: name

    location:
        label: acornassociated.calendar::lang.models.general.location
        modelClass: AcornAssociated\Location\Models\Location
        conditions: (select ce.location_id from acornassociated_calendar_event_parts ce where event_part_id = ce.id) in (:filtered)
        nameFrom: name

    groups:
        label: acornassociated.calendar::lang.models.general.groups
        modelClass: AcornAssociated\Calendar\Models\EventPart
        conditions: exists(select * from acornassociated_calendar_event_part_user_group ug where acornassociated_calendar_instances.event_part_id = ug.event_part_id and user_group_id in (:filtered))
        options: groupsAll

    users:
        label: acornassociated.calendar::lang.models.general.users
        modelClass: AcornAssociated\Calendar\Models\EventPart
        conditions: exists(select * from acornassociated_calendar_event_part_user u where acornassociated_calendar_instances.event_part_id = u.event_part_id and u.user_id in (:filtered))
        options: usersAll

    # TODO: User now uses the User plugin and uuids
    #myevents:
        #label: acornassociated.calendar::lang.models.calendar.my_events
        #type: checkbox
        #conditions: (select owner_user_id from acornassociated_calendar_event_parts cep inner join acornassociated_calendar_events ce on cep.event_id = ce.id where event_part_id = cep.id) = :user

    #myattendance:
        #label: acornassociated.calendar::lang.models.calendar.attending
        #type: checkbox
        #conditions: (:user in(select user_id from acornassociated_calendar_event_part_user u where acornassociated_calendar_instances.event_part_id = u.event_part_id) or exists(select * from acornassociated_calendar_event_part_user_group ug where acornassociated_calendar_instances.event_part_id = ug.event_part_id and ug.user_group_id in(:groups)))
